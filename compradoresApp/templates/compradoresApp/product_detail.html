{% extends "compradoresApp/base.html" %}

{% block title %}{{ product.nombre }}{% endblock %}

{% block content %}
<div class="product-detail">

  <div class="left">
    {% if product.imagen %}
      <img src="{{ product.imagen.url }}" class="bigimg">
    {% endif %}
  </div>

  <div class="right">
    <h1>{{ product.nombre }}</h1>

    <p class="meta">
      {{ product.categoria }} • {{ product.tienda.ubicacion }}
    </p>

    <div class="price">Precio: <strong>${{ product.precio }}</strong></div>
    <p>{{ product.descripcion }}</p>

    <div class="actions">
      <form method="post" action="{% url 'compradores:create_order' product.pk %}">{% csrf_token %}
        <button class="btn">Comprar</button>
      </form>

      <form method="post" action="{% url 'compradores:toggle_favorite' product.pk %}">{% csrf_token %}
        <button class="btn ghost">
          {% if is_fav %}Quitar favorito{% else %}Agregar favorito{% endif %}
        </button>
      </form>
    </div>

    <hr>

    <h3>Reseñas</h3>
    {% for r in reviews %}
      <div class="review">
        <strong>{{ r.author.username }}</strong>
        <span class="rating">⭐ {{ r.rating }}</span>
        <p>{{ r.comment }}</p>

        {% if r.artisan_response %}
          <div class="artisan-response">Respuesta del artesano: {{ r.artisan_response }}</div>
        {% endif %}
      </div>
    {% empty %}
      <p>No hay reseñas todavía.</p>
    {% endfor %}
  </div>

</div>

<div class="review-box">
  {% include "compradoresApp/review_form.html" %}
</div>
{% endblock %}
